---
// WAJIB ADA TANDA INI DI BARIS PERTAMA
import { getCollection } from "astro:content";
import MainLayout from "../../layouts/MainLayout.astro";
import RatingSummary from "../../components/RatingSummary.astro";
import ReviewCard from "../../components/ReviewCard.astro";

const allReviews = await getCollection("reviews");
const sortedReviews = allReviews.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<MainLayout title="Community Stories">
  <div class="px-4 md:px-12 max-w-5xl mx-auto py-16">
    <header class="mb-12">
      <h1 class="text-4xl font-bold text-white mb-2 font-noto-serif">Community Stories</h1>
      <p class="text-slate-400 text-sm">Discover Bandung through the eyes of our fellow travelers.</p>
    </header>

    <RatingSummary allReviews={sortedReviews} />

    <div class="flex justify-between items-center mb-10">
      <h2 class="text-xl font-bold text-white">Recent Experience</h2>
      <a 
        href="/reviews/write" 
        class="bg-emerald-500 text-slate-950 px-8 py-3 rounded-full font-bold text-sm hover:bg-emerald-400 transition-all shadow-lg"
      >
        Write a Review
      </a>
    </div>

    <div class="space-y-6">
      {sortedReviews.length > 0 ? (
        sortedReviews.map(review => <ReviewCard review={review.data} />)
      ) : (
        <div class="text-center py-20 border-2 border-dashed border-slate-800 rounded-[32px]">
          <p class="text-slate-500">Belum ada ulasan. Jadilah yang pertama bercerita!</p>
        </div>
      )}
    </div>
  </div>
</MainLayout>