---
// src/pages/admin/users/edit.astro
import AdminLayout from "@/layouts/AdminLayout.astro";
import { UserForm } from "@/components/admin/UserForm";
import sql from "@/lib/db";

const id = Astro.url.searchParams.get("id");
let userData = null;

if (id) {
  const users = await sql`SELECT id, email, display_name, role FROM users WHERE id = ${id}`;
  userData = users[0];
}

// Jika ID tidak valid, balikkan ke daftar user
if (!userData) return Astro.redirect("/admin/users");

interface User {
  id: number;
  email: string;
  display_name: string;
  role: string;
  tanggal: Date;
}

const usersData = await sql<User[]>`
  SELECT id, email, display_name, role, tanggal 
  FROM users 
  ORDER BY tanggal DESC
`;

---

<AdminLayout 
  title="Edit User" 
  description="Halaman untuk mengedit data pengguna"
>
  <UserForm client:load mode="edit" initialData={userData} />
</AdminLayout>