---
// src/pages/admin/destinations/edit.astro
import AdminLayout from "@/layouts/AdminLayout.astro";
import { DestinationForm } from "@/components/admin/DestinationForm";
import sql from "@/lib/db";

// 1. Ambil ID dari URL (misal: /admin/destinations/edit?id=5)
const id = Astro.url.searchParams.get("id");
let destinationData = null;

if (id) {
  // 2. Ambil data destinasi berdasarkan ID
  const result = await sql`
    SELECT id, provinsi, kotakabupaten, dtw, latitude, longitude, 
           deskripsi_lengkap, url_foto, author, lokasi, tags, rating 
    FROM lokasi_wisata 
    WHERE id = ${id}
  `;
  destinationData = result[0];
}

// 3. Jika ID tidak ditemukan, arahkan kembali ke dashboard
if (!destinationData) return Astro.redirect("/admin");
---

<AdminLayout title="Edit Destination" description="Perbarui informasi tempat wisata">
  <main class="max-w-4xl mx-auto px-4 py-16">
    <header class="mb-10 text-center">
      <h1 class="text-4xl font-bold text-slate-900 font-noto-serif">Edit Destination</h1>
      <p class="mt-2 text-slate-500">Ubah detail untuk {destinationData.dtw}</p>
    </header>

    <div class="bg-white p-8 md:p-12 rounded-[40px] border border-slate-100 shadow-xl">
      <DestinationForm client:load mode="edit" initialData={destinationData} />
    </div>
  </main>
</AdminLayout>