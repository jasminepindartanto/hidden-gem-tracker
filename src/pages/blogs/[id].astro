---
import MainLayout from "@/layouts/MainLayout.astro";
import FormattedDate from "@/components/FormattedDate.astro";
import ShareButtons from "@/components/ShareButtons.astro";
import sql from "@/lib/db";
import { SITE_TITLE } from "@/consts";

const { id } = Astro.params;

// Validasi agar tidak error ts(2769)
if (!id) return Astro.redirect("/404");

const result = await sql`SELECT * FROM lokasi_wisata WHERE id = ${id}`;
const post = result[0];
if (!post) return Astro.redirect("/404");

const ulasanData = await sql`SELECT * FROM ulasan WHERE lokasi_id = ${id} ORDER BY tanggal DESC`;
const origin = Astro.url.origin;
---

<MainLayout title={`${post.dtw} | ${SITE_TITLE}`} description={post.deskripsi_lengkap}>
  <article class="container mx-auto px-4 py-8">
    {post.url_foto && (
      <img src={post.url_foto} alt={post.dtw} class="w-full h-auto rounded-2xl mb-8" />
    )}
    <h1 class="text-4xl font-bold text-white mb-6 text-center">{post.dtw}</h1>
    
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
      <div class="lg:col-span-2">
        <div class="text-slate-300 whitespace-pre-line leading-relaxed">
          {post.deskripsi_lengkap}
        </div>
      </div>

      <aside>
        <div class="bg-slate-900 p-6 rounded-2xl border border-slate-800 sticky top-24">
          <h4 class="text-white font-bold mb-4">GIS Details</h4>
          <p class="text-slate-400 text-sm">Lat: {post.latitude}</p>
          <p class="text-slate-400 text-sm">Lon: {post.longitude}</p>
          
          <a 
            href={`https://www.google.com/maps/search/?api=1&query=${post.latitude},${post.longitude}`}
            target="_blank"
            class="block w-full bg-teal-600 text-white text-center py-3 rounded-xl mt-6 font-bold"
          >
            Buka Rute Perjalanan
          </a>
        </div>
      </aside>
    </div>
  </article>
</MainLayout>