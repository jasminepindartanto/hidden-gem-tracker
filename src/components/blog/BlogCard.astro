---
import { Image } from "astro:assets";
import ShareButtons from "../ShareButtons.astro";

export interface Blog {
  id: string;
  title: string;
  rating?: number;
  href?: string;
  author?: string;
  pubDate: Date | string;
  description?: string;
  image?: string;
  tags?: string[];
  icon?: string;
  location?: string;
  // Properti kunci untuk mengubah tampilan
  showExtraDetails?: boolean;
}

interface Props {
  blog: Blog;
}

const origin = Astro.url.origin;
const { blog } = Astro.props;
const url = `${origin}/blogs/${blog.id}`;

function getCategoryColor(blogId: string) {
  const gradients = [
    "from-emerald-400/10 to-emerald-400/20",
    "from-amber-100 to-amber-200",
    "from-gray-100 to-gray-200",
    "from-blue-100 to-blue-200",
    "from-pink-100 to-pink-200",
    "from-purple-100 to-purple-200",
    "from-teal-100 to-teal-200",
    "from-orange-100 to-orange-200",
    "from-lime-100 to-lime-200",
    "from-cyan-100 to-cyan-200",
  ];
  const sum = blogId
    .split("")
    .reduce((acc, char) => acc + char.charCodeAt(0), 0);
  const index = sum % gradients.length;
  return gradients[index];
}

const formatDate = (date: Date | string) => {
  if (typeof date === "string") return date;
  return date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "numeric",
    day: "numeric",
  });
};
---

<div
  class="relative overflow-hidden bg-slate-900/50 border border-slate-700 pt-0 gap-0 w-full flex flex-col cursor-pointer transition-all duration-300 hover:-translate-y-1 hover:border-emerald-500/50 hover:shadow-lg hover:shadow-emerald-500/10 rounded-xl"
>
  <a href={`/blogs/${blog.id}`} class="flex flex-col flex-grow">
    <header class="p-0 gap-0">
      <div class="aspect-video w-full bg-slate-800 relative group overflow-hidden">
        {blog.rating && (
          <div class="absolute top-3 right-3 z-10 flex items-center gap-1 rounded-lg bg-white/95 px-2.5 py-1 text-[11px] font-bold text-slate-900 shadow-sm border border-slate-200/50">
            <span class="text-yellow-500 text-[13px]">‚≠ê</span>
            <span>{blog.rating.toFixed(1)}</span>
          </div>
        )}

        {blog.image ? (
          <Image
            src={blog.image}
            alt={blog.title}
            width={800}
            height={450}
            class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
          />
        ) : (
          <div class="flex h-full items-center justify-center">
            <div class={`h-full w-full bg-gradient-to-br ${getCategoryColor(blog.id)}`} />
          </div>
        )}
      </div>
    </header>

    <div class="p-4 flex flex-col flex-grow">
      <h3 class="mt-1 line-clamp-2 font-noto-serif text-xl text-slate-100 font-bold group-hover:text-emerald-400 transition-colors">
        {blog.title}
      </h3>

      {blog.location && (
        <p class="text-[11px] text-emerald-400 font-medium mt-1.5 flex items-center gap-1">
          <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="flex-shrink-0">
            <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/>
            <circle cx="12" cy="10" r="3"/>
          </svg>
          <span class="truncate">{blog.location}</span>
        </p>
      )}

      <p class="mt-3 line-clamp-2 text-sm text-slate-400 leading-relaxed">
        {blog.description}
      </p>

      {blog.showExtraDetails && (
        <div class="mt-5 h-24 w-full rounded-xl bg-slate-800/50 border border-slate-700 overflow-hidden relative">
          <div class="absolute inset-0 opacity-10" style="background-image: radial-gradient(#fff 1px, transparent 1px); background-size: 10px 10px;"></div>
          <div class="absolute inset-0 flex items-center justify-center">
            <div class="relative">
              <div class="w-3 h-3 bg-red-500 rounded-full shadow-[0_0_12px_rgba(239,68,68,0.7)] animate-pulse"></div>
            </div>
          </div>
        </div>
      )}
    </div>

    <footer class="p-4 pt-0">
      <div class="flex items-center justify-between border-t border-slate-800 pt-4">
        <div class="text-[11px] text-slate-500 font-medium uppercase tracking-wider">
          {formatDate(blog.pubDate)}
        </div>
        <div class="text-[11px] text-slate-500 font-medium uppercase tracking-wider">
          {blog.author}
        </div>
      </div>
    </footer>
  </a>

  <div class="p-4 pt-0">
    <div class="flex items-center justify-between gap-4">
      {blog.showExtraDetails ? (
        // TOMBOL FULL WIDTH UNTUK HALAMAN DESTINATIONS
        <a 
          href={`/blogs/${blog.id}`} 
          class="flex-grow py-3 bg-emerald-500 hover:bg-emerald-600 text-slate-900 text-center rounded-xl font-bold text-xs tracking-widest transition-all shadow-lg shadow-emerald-500/20 active:scale-95"
        >
          VIEW DETAILS
        </a>
      ) : (
        // LINK READ MORE UNTUK HALAMAN UTAMA
        <a href={`/blogs/${blog.id}`} class="text-xs font-bold text-emerald-400 hover:text-emerald-300 transition-colors flex items-center gap-1">
          READ MORE
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
        </a>
      )}
      
      <div class="flex items-center gap-2">
        <ShareButtons url={url} title={blog.title} description={blog.description} />
      </div>
    </div>
  </div>
</div>