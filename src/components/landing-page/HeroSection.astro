---
import { DOODLE_EMOJIS } from "@/consts";
import type { Doodle } from "@/schemas/doodle";
import ScrollingTags from "./ScrollingTags.astro";

export interface Props {
  uniqueTags: string[];
  doodle?: Doodle & { href: string };
  isLoggedIn?: boolean;
}

const { uniqueTags, doodle, isLoggedIn } = Astro.props as Props;
const doodleEmoji =
  DOODLE_EMOJIS[Math.floor(Math.random() * DOODLE_EMOJIS.length)];
---

<section class="relative h-[calc(100vh-4rem)] overflow-hidden bg-gradient-to-br from-emerald-950 via-green-900 to-emerald-950">
  <div class="absolute inset-0 bg-[linear-gradient(to_right,#0f172a_1px,transparent_1px),linear-gradient(to_bottom,#0f172a_1px,transparent_1px)] bg-[size:4rem_4rem] [mask-image:radial-gradient(ellipse_60%_50%_at_50%_0%,#000_70%,transparent_110%)] animate-pulse"></div>

  <ScrollingTags uniqueTags={uniqueTags} />

  <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-emerald-500/10 rounded-full blur-3xl animate-pulse"></div>
  <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-blue-500/10 rounded-full blur-3xl animate-pulse delay-1000"></div>

  <div class="relative mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 h-full flex items-center pointer-events-none">
    <div class="text-center w-full">
      <div class="relative flex flex-col justify-center items-center pointer-events-auto" id="hidden-text">
        
        <div id="hero-content">
          {doodle ? (
            <>
              <h1 class="mb-4 text-5xl font-bold tracking-tight text-white sm:text-7xl">
                <span class="relative inline-block text-primary text-glow animate-pulse">{doodleEmoji}</span>&nbsp;{doodle.title}
              </h1>
              <p class="mx-auto max-w-3xl text-xl text-white leading-relaxed">{doodle.description}</p>
            </>
          ) : (
            <>
              <h1 class="mb-4 text-5xl font-bold tracking-tight text-white sm:text-7xl">
                <span class="relative inline-block text-primary text-glow animate-pulse">The Paris Of Java,</span> Uncovered
              </h1>
              <p class="mx-auto max-w-3xl text-xl text-white leading-relaxed">
                Find the best secret spots <span class="text-nebula">From Misty</span>, <span class="text-solar">Craters to</span> and <span class="text-nebula">artistic cafes</span> in Bandung
              </p>
            </>
          )}

          <div class="flex flex-col sm:flex-row gap-4 justify-center items-center mt-8">
            {!isLoggedIn && (
              <a 
                href="/auth/login" 
                class="inline-flex items-center justify-center gap-2 px-8 py-4 bg-emerald-500 hover:bg-emerald-400 text-slate-950 rounded-2xl font-bold text-lg transition-all shadow-lg active:scale-95 tracking-tight pointer-events-auto"
              >
                <span>Get Started</span>
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
              </a>
            )}

            <a 
              href="/blogs" 
              class="inline-flex items-center justify-center gap-2 px-8 py-4 bg-emerald-900/50 backdrop-blur-sm hover:bg-slate-800 text-white border border-slate-700 rounded-2xl font-bold text-lg transition-all tracking-tight pointer-events-auto"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/></svg>
              <span>Explore Destinations</span>
            </a>
          </div>
        </div>

        {doodle && (
          <a href={doodle.href} class="mt-6 inline-flex items-center gap-2 px-6 py-3 bg-white/10 hover:bg-white/20 rounded-lg transition-colors opacity-0 translate-y-2 pointer-events-none transform" data-hero-button>
            Know More â†’
          </a>
        )}
      </div>
    </div>
  </div>
</section>

<script>
  import { createTimeline, stagger, text } from "animejs";

  document.addEventListener("DOMContentLoaded", () => {
    const heroContent = document.getElementById("hero-content");
    const heroButton = document.querySelector("[data-hero-button]") as HTMLAnchorElement | null;

    if (heroContent) {
      const { chars } = text.split(heroContent, { words: false, chars: true });
      const headlineTimeline = createTimeline({ loop: false, defaults: { ease: "inOut(3)", duration: 1500 } });

      headlineTimeline
        .add(chars, {
          y: [($el) => (+$el.dataset.line % 2 ? "100%" : "-200%"), "0%"],
          opacity: [0, 1],
        }, stagger(10, { from: "random" }))
        .init()
        .then(() => {
          if (heroButton) {
            heroButton.classList.remove("opacity-0", "translate-y-2", "pointer-events-none");
            heroButton.classList.add("pointer-events-auto");
          }
          document.dispatchEvent(new Event("start-tags"));
        });
    }
  });
</script>